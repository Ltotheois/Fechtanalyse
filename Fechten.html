<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<link rel="icon" type="image/png" href="title.png" />
<link rel="stylesheet" type="text/css" href="stylesheet.css">
<link href="fontawesome/css/all.css" rel="stylesheet">
<link rel="manifest" crossorigin="use-credentials" href="manifest.json" />
<link rel="apple-touch-icon" href="title.png"/>
<title>Luis' Fencing Tool for all those who could not use an Excel Table</title>
</head>
<body>
	<div class="alert_container" id="alert_container">
	</div>

	<div class="header_div">
		<img id="title_icon" src="favicon.svg" alt="TRACE - Tool for Remotely Accessing and Controlling Experiments" onclick="toggle_overlay();">
	</div>

	<div id="overlay" class="overlay">
		<div class="overlay_content">
			<a class="overlay_action" onclick="save();">
				<i class="far fa-save"></i>
				<span>Save</span>
			</a>
			<a class="overlay_action" onclick="load()" >
				<i class="fas fa-file-upload"></i>
				<span>Load</span>
			</a>
			<a class="overlay_action" onclick="toggle_theme();">
				<i class="fas fa-palette"></i>
				<span>Change theme</span>
			</a>
			<a class="overlay_action" onclick="show_all_alerts();">
				<i class="fas fa-info-circle"></i>
				<span>Show all alerts</span>
			</a>
			<a class="overlay_action" onclick="save(ls=true);">
				<i class="fas fa-list"></i>
				<span>Save Defaults</span>
			</a>
			<a class="overlay_action" onclick="load(ls=true);">
				<i class="fas fa-list"></i>
				<span>Load Defaults</span>
			</a>
			<a class="overlay_action" onclick="change_quote();">
				<i class="fas fa-quote-left"></i>
				<span>Change Quote</span>
			</a>
			<!--<a class="overlay_action" id="update_sw_button">
				<i class="fas fa-sync"></i>
				<span>Update</span>
			</a>-->
		</div>
		<div id="manual_div">
			
		</div>
		<div id="log_div" class="dgrid">
		</div>
	</div>
	
	<div id="overlay_modal" class="overlay" style="color:var(--overlay-color);">
		<div style="display:flex; flex-wrap:wrap; justify-content:space-between; padding:10px; min-width:400px; margin-left:auto; margin-right:auto; max-width:600px; margin-top:90px;">
			<div>
				<div style="display:flex; flex-direction:row;">
					<label style="font-size:25px;">Left</label>
					<button class="icon_button"><i class="fas fa-user-plus" onclick="add_name('left');"></i></button>
				</div>
				<label style="text-align:left;">Names Left</label>
				<div id="names_left_div" style="display: flex; flex-direction: column;align-items: flex-start;"></div>
			</div>
			
			<div>
				<div style="display:flex; flex-direction:row-reverse;">
					<label style="font-size:25px;">Right</label>
					<button class="icon_button"><i class="fas fa-user-plus" onclick="add_name('right');"></i></button>
				</div>
				<label style="text-align:right;display:block;margin-left:auto;">Names Right</label>
				<div id="names_right_div" style="display: flex; flex-direction: column;align-items: flex-end;"></div>
			</div>
		</div>
	</div>
	
	
	<div id="container">
		<div class="tile" id="general" >
			<h2 style="display:flex;">General <label style="margin-left:auto;" for="general_team">Team: </label><input id="general_team" type="checkbox"></h2>
			<div class="dgrid">
				<div style="display:flex; flex-direction:row;">
					<label for="general_left" style="font-size:25px;">Left</label>
					<button class="icon_button"><i class="fas fa-user-edit" onclick="alter_names();"></i></button>
				</div>
				<div style="display:flex; flex-direction:row-reverse;">
					<label for="general_right" style="font-size:25px;">Right</label>
					<button class="icon_button"><i class="fas fa-user-edit" onclick="alter_names();"></i></button>
				</div>
				
				<select id="general_left_name">
				</select>
				<select id="general_right_name">
				</select>
				<input id="general_left_score" class="score" value=0 type="number" readonly>
				<input id="general_right_score" class="score" value=0 type="number" readonly>
				
				<div style="height:20px;"></div>
				<div style="height:20px;"></div>
				
				<label for="general_tournament">Tournament: </label>
				<input id="general_tournament">
				
				<label for="general_place">Place: </label>
				<input id ="general_place">
				
				<label for="general_referee">Referee: </label>
				<input id="general_referee">
				
				<label for="general_tableau">Tableau: </label>
				<input id="general_tableau">
				
			</div>
		</div>
		
		<div class="tile" id="Touch">
			<h2>Add Touch</h2>
			<div class="dgrid">
				<div style="min-width:360px; grid-column: 1/3; display:flex; justify-content:center;">
					<div class="tab">
						<button class="tablinks" onclick="radiobuttons(this);" id="tab_touch_left">Touch Left</button>
						<button class="tablinks" onclick="radiobuttons(this);" id="tab_touch_none">No Touch</button>
						<button class="tablinks" onclick="radiobuttons(this);" id="tab_touch_right">Touch Right</button>
					</div>
				</div>
				<div class="tab" style="display:flex; justify-content:flex-start;padding-top:20px;">
					<button class="tablinks" onclick="radiobuttons(this);" id="tab_left_0">0</button>
					<button class="tablinks" onclick="radiobuttons(this);" id="tab_left_1">1</button>
					<button class="tablinks" onclick="radiobuttons(this);" id="tab_left_2">2</button>
					<button class="tablinks" onclick="radiobuttons(this);" id="tab_left_3">3</button>
				</div>
				<div class="tab" style="display:flex; justify-content:flex-end;padding-top:20px;">
					<button class="tablinks" onclick="radiobuttons(this);" id="tab_right_3">3</button>
					<button class="tablinks" onclick="radiobuttons(this);" id="tab_right_2">2</button>
					<button class="tablinks" onclick="radiobuttons(this);" id="tab_right_1">1</button>
					<button class="tablinks" onclick="radiobuttons(this);" id="tab_right_0">0</button>
				</div>
				
				
				<label for="touch_left_notes" style="text-align:left;padding-top:20px;">Notes Left</label>
				<label for="touch_right_notes" style="text-align:right;padding-top:20px;">Notes Right</label>
				<textarea id="touch_left_notes"></textarea>
				<textarea id="touch_right_notes"></textarea>
				<button class="button" style="justify-self: center;" onclick="show_abbrev_modal('left');">Abbreviations</button>
				<button class="button" style="justify-self: center;" onclick="show_abbrev_modal('right');">Abbreviations</button>

				<div style="padding-top:10px;grid-column: 1/3; display:flex; justify-content:center;">
					<button class="button" onclick="add_touch();">Add Touch</button>
				</div>
			</div>
		</div>
		
		<div class="tile" id="table_tile">
			<div class="dgrid">
					<button class="button" onclick="analysis();">Analysis</button>
					<div class="inline_icon_div">
						<a class="clickable" onclick="document.getElementById('table').classList.toggle('hide_icons')"><i class="fa fa-eye-slash"></i></a>
						<a class="clickable" onclick="document.getElementById('table_tile').classList.toggle('hide_cells')"><i class="fas fa-table"></i></a>
						<a class="clickable" onclick="delete_row(all=true)"><i class="fas fa-trash"></i></a>
					</div>
				</div>
			<div id="table_container">
				<table id="table" class="hide_icons">
					<thead id="table_head">
						<tr>
							<th><i class="fas fa-user"></i></th>
							<th><i class="fas fa-lightbulb"></i></th>
							<th><i class="fas fa-tachometer-alt"></i></th>
							<th><i class="fas fa-clipboard"></i></th>
							<th><i class="fas fa-trophy"></i></th>
							<th><i class="fas fa-tools"></i></th>
							<th><i class="fas fa-trophy right"></i></th>
							<th><i class="fas fa-clipboard right"></i></th>
							<th><i class="fas fa-tachometer-alt right"></i></th>
							<th><i class="fas fa-lightbulb right"></i></th>
							<th><i class="fas fa-user right"></i></th>
						</tr>
					</thead>
					<tbody id="table_body">
					</tbody>
				</table>
			</div>
		</div>
	
		<div class="tile" id="analysis_tile" style="min-width: 500px;">
			<h2>Analysis</h2>
			<div id="table_container_analysis">
			</div>
		</div>
	
	</div>
	<div id="quote1" class="quote" style="opacity:0;"><span><!-- quote --></span></div>
	<div id="quote2" class="quote" style="position:absolute; bottom:0px; left:0px;"><span><!-- quote --></span></div>
<script>
var overlay_modal = document.getElementById('overlay_modal');
var overlay = document.getElementById('overlay');
var table_body = document.getElementById('table_body');
var team_select = document.getElementById('general_team');

function toggle_overlay(){
	var img = document.getElementById("title_icon");
	if (overlay_modal.classList.contains("active")){
		overlay_modal.classList.remove("active");
		document.body.classList.remove('modal_active');
		update_names();
		return;
	}
	window.scroll(0,0);
	img.classList.toggle('active');
	overlay.classList.toggle('active');
	document.body.classList.toggle('modal_active');
}

function alter_names(){
	if (overlay.classList.contains("active")){
		overlay.classList.remove("active");
		return;
	}

	window.scroll(0,0);
	overlay_modal.classList.toggle('active');
	document.body.classList.toggle('modal_active');
}

function add_name(side, value=""){
	var container = document.getElementById("names_" + side + "_div");
	
	new_div = document.createElement('div');
	new_div.classList.add("name_input");
	new_div.innerHTML = "<input value="+value+"><button class=\"close_button\" onclick='this.parentNode.parentNode.removeChild(this.parentElement);'>✖</button>"
	
	container.append(new_div);
}

function update_names(){
	for (side of ["left", "right"]){
		var container_div = document.getElementById("names_" + side + "_div");
		var inputs = container_div.getElementsByTagName('input');
				
		var select = document.getElementById("general_" + side + "_name");
		while (select.options.length > 0) {
			select.remove(0);
		}
		
		for (input of inputs){
			var val = input.value;
			var option = new Option(val, val);
			select.add(option);
		}
		
	}
}

function radiobuttons(elem){
	if (!elem.classList.contains("active")){
		for (child of elem.parentElement.children){
			child.classList.remove("active");
		}
	}
	elem.classList.add("active");
}

function current_score(){
	var data = table_body_to_array(table_body);
	var score_left = [];
	var score_right = [];
	
	var curr_left = 0;
	var curr_right = 0;
	
	var i = 0;
	for (var row of data){
		table_body.rows[i].cells[4].innerHTML = curr_left;
		table_body.rows[i].cells[6].innerHTML = curr_right;
		if (row[1]){
			score_left.push(1);
			curr_left++;
		}else{
			score_left.push(0);		
		}
		if (row[9]){
			score_right.push(1);
			curr_right++;
		}else{
			score_right.push(0);		
		}
		i++;
	}
	
	
	var result_left = score_left.reduce(function(a, b){
		return a + b;
	}, 0);
	
	var result_right = score_right.reduce(function(a, b){
		return a + b;
	}, 0);
	
	document.getElementById("general_left_score").value = result_left;
	document.getElementById("general_right_score").value = result_right;
	
	return([result_left, result_right, score_left, score_right])
}

function add_touch(){
	var data = [];
	var tmp = 0;
	var score = [document.getElementById("general_left_score").value, document.getElementById("general_right_score").value];

	var touch = "none";
	for (id of ["tab_touch_left", "tab_touch_right"]){
		if (document.getElementById(id).classList.contains("active")){
			touch = id.replace("tab_touch_", "");
			break;
		}
	}
	
	var checked_left = false;
	var checked_right = false;
	
	if (touch == "right"){
		checked_right = true;
	}else if (touch == "left"){
		checked_left  = true;
	}

	var e = document.getElementById("general_left_name");
	tmp = "";
	if (e.selectedIndex != -1){tmp = e.options[e.selectedIndex].text;}
	data.push(tmp);
	
	data.push(checked_left);
	
	tmp = 0;
	for (id of ["tab_left_0", "tab_left_1", "tab_left_2", "tab_left_3"]){
		if (document.getElementById(id).classList.contains("active")){
			tmp = id.replace("tab_left_", "");
			break;
		}
	}
	data.push(tmp);
	
	tmp = document.getElementById("touch_left_notes").value;
	data.push(tmp);
	
	data.push(score[0]);
	data.push("");
	data.push(score[1]);
	
	tmp = document.getElementById("touch_right_notes").value;
	data.push(tmp);
	
	tmp = 0;
	for (id of ["tab_right_0", "tab_right_1", "tab_right_2", "tab_right_3"]){
		if (document.getElementById(id).classList.contains("active")){
			tmp = id.replace("tab_right_", "");
			break;
		}
	}
	data.push(tmp);
	
	data.push(checked_right);
	
	var e = document.getElementById("general_right_name");
	tmp = "";
	if (e.selectedIndex != -1){tmp = e.options[e.selectedIndex].text;}
	data.push(tmp);
	
	// Cleaning the Interface
	for (id of ["tab_right_0", "tab_right_1", "tab_right_2", "tab_right_3", "tab_left_0", "tab_left_1", "tab_left_2", "tab_left_3", "tab_touch_left", "tab_touch_right", "tab_touch_none"]){
		document.getElementById(id).classList.remove("active");
	}
	document.getElementById("touch_left_notes").value = "";
	document.getElementById("touch_right_notes").value = "";
	create_table_rows(table_body, [data]);
	var e = document.getElementById("table_container");
	e.scrollTop = e.scrollHeight;
	current_score();
}

function table_body_to_array(table_body){
	var output=[];
	var rows = table_body.children;
	for(var row of rows){
		var cells = row.children;
		var row_tmp = [];
		for (var cell of cells){
			if (cell.children.length != 0){
				var child = cell.children[0];
				if (child.type && child.type === "checkbox"){
					row_tmp.push(child.checked);
				}else if (child.nodeName == "INPUT"){
					row_tmp.push(cell.children[0].value);
				}else{
					row_tmp.push(cell.innerHTML);
				}
			}else{
				row_tmp.push(cell.innerHTML);
			}
		}
		output.push(row_tmp);
	}
	return(output);
}

function create_table_rows(table_body, data=[]){
	if (data.length==0){return}
	for (var rowData of data) {
		var row = document.createElement('tr');
		var tmp_row = [];
		checked_left = "";
		checked_right = "";
		if (rowData[1]){checked_left = "checked";};
		if (rowData[9]){checked_right = "checked";};
		tmp_row.push(rowData[0]);
		tmp_row.push("<input type='checkbox' " + checked_left + " onchange='current_score();'>");
		tmp_row.push(rowData[2]);
		tmp_row.push(rowData[3]);
		tmp_row.push(rowData[4]);
		tmp_row.push('<a class="clickable" onclick="delete_row();"><i class="fa fa-times"></i></a>');
		tmp_row.push(rowData[6]);
		tmp_row.push(rowData[7]);
		tmp_row.push(rowData[8]);
		tmp_row.push("<input type='checkbox' " + checked_right + " onchange='current_score();'>");
		tmp_row.push(rowData[10]);
		for (var i=0; i<tmp_row.length; i++){
			var cell = document.createElement('td');
			if (i != 5 && i != 4 && i != 6 && i != 1 && i != 9){cell.contentEditable = true;}
			cell.classList.add("output_cell");
			cell.innerHTML = tmp_row[i];
			row.appendChild(cell);
		};

		table_body.appendChild(row);
	};
}

function delete_row(all=false){
	if (all == false){
		var td = event.target.parentNode.parentNode;
		var tr = td.parentNode;
		tr.parentNode.removeChild(tr);
	}else{
		table_body.innerHTML = "";
	}
}

function searchForArray(haystack, needle){
  var i, j, current;
  for(i = 0; i < haystack.length; ++i){
    if(needle.length === haystack[i].length){
      current = haystack[i];
      for(j = 0; j < needle.length && needle[j] === current[j]; ++j);
      if(j === needle.length)
        return i;
    }
  }
  return -1;
}

function tendence_score(array){
	var left = 0;
	var right = 0;
	var total = 0;
	total = array.length;
	
	for (row of array){
		if (row[1]){
			left++;
		}
		if (row[9]){
			right++;
		}
	}
	return([left, total, right])
}

function analysis(){
	data = table_body_to_array(table_body);
	data.sort(function(a,b) {
		if (a[4]-b[4] != 0){
			return a[4]-b[4]
		}else{
			return a[6]-b[6]
		}
	});
	
	if (data.length == 0){
		shoot_alert("No data found! Please add touches first.", 0) 
	}
	
	var athlete_pairs = [];
	for (var i=0; i<data.length; i++){
		var tmp = [data[i][0], data[i][10]];
		if (searchForArray(athlete_pairs, tmp) == -1){
			athlete_pairs.push(tmp);
		}
	}
	var results = {}
	for (var i in athlete_pairs){
		results[i] = {}
		results[i]["first_half"] = {};
		results[i]["second_half"] = {};
		var tmp = data.filter(function(val){return(val[0]==athlete_pairs[i][0] && val[10]==athlete_pairs[i][1])});
		for (var tl=0; tl<4; tl++){
			for (var tr=0; tr<4; tr++){
				var tmp_2 = tmp.filter(function(val){return(val[2]==tl && val[8]==tr)});
				var first_half = tmp_2.filter(function(val){return(val[4]<8 && val[6]<8)});
				var second_half = tmp_2.filter(function(val){return(val[4]>=8 || val[6]>=8)});
				
				results[i]["first_half"][tl + ":" + tr] = tendence_score(first_half);
				results[i]["second_half"][tl + ":" + tr] = tendence_score(second_half);
			}
		}
	}
	
	document.getElementById("table_container_analysis").innerHTML = "";
	
	for (var i=0; i<athlete_pairs.length; i++){
		create_analysis_table(results[i], athlete_pairs[i][0], athlete_pairs[i][1]);
	}
}

function create_analysis_table(data, left_name, right_name){
	var container = document.getElementById("table_container_analysis");
	var div = document.createElement("div");
	var team_selected = team_select.checked;
	var toggle_icon = '<a class="clickable" onclick="this.parentElement.parentElement.parentElement.classList.toggle(\'hide_halves\')"><i class="fa fa-eye-slash"></i></a>'
	if (team_selected){
		toggle_icon = "";
		div.classList.add("hide_halves");
	}
	div.innerHTML = '<div class="dgrid"><span>'+ left_name + ' vs. ' +right_name + ' </span><div class="inline_icon_div">' + toggle_icon + '<a class="clickable" onclick="this.parentNode.parentNode.parentNode.parentNode.removeChild(this.parentNode.parentNode.parentNode)"><i class="fas fa-trash"></i></a></div></div>'
	var table = document.createElement("table");
	table.classList.add("analysis_table");
	var body = document.createElement("tbody");
	
	var head = document.createElement("thead");
	var tr = document.createElement("tr");
	var th = document.createElement("th");
	th.innerHTML = "";
	tr.appendChild(th);
	for (var i=0; i<4; i++){
		var th = document.createElement("th");
		th.innerHTML = i;
		tr.appendChild(th);
	}
	var th = document.createElement("th");
	th.innerHTML = "∑";
	tr.appendChild(th);
	head.appendChild(tr);
	table.appendChild(head);
	
	for (var row=0; row<5; row++){
		var tr = document.createElement("tr");
		for (var col=-1; col<5; col++){
			var td = document.createElement("td");
			if (row==4 && col == 4){
				var fh = [0,0,0];
				var sh = [0,0,0];
				for (var k=0; k<4; k++){
					for (var l=0; l<4; l++){
						var tmp = data["first_half"][k+":"+l];
						fh[0] = fh[0] + tmp[0];
						fh[1] = fh[1] + tmp[1];
						fh[2] = fh[2] + tmp[2];
						var tmp = data["second_half"][k+":"+l];
						sh[0] = sh[0] + tmp[0];
						sh[1] = sh[1] + tmp[1];
						sh[2] = sh[2] + tmp[2];
					}
				}
			}else if (col==-1){
				if (row == 4){
					td.innerHTML = "∑";
				}else{
					td.innerHTML = row;
				}
				tr.appendChild(td);
				continue;
			}else if (row==4){
				var fh = [0,0,0];
				var sh = [0,0,0];
				for (var k=0; k<4; k++){
					var tmp = data["first_half"][k+":"+col];
					fh[0] = fh[0] + tmp[0];
					fh[1] = fh[1] + tmp[1];
					fh[2] = fh[2] + tmp[2];
					var tmp = data["second_half"][k+":"+col];
					sh[0] = sh[0] + tmp[0];
					sh[1] = sh[1] + tmp[1];
					sh[2] = sh[2] + tmp[2];
				}
			}else if (col==4){
				var fh = [0,0,0];
				var sh = [0,0,0];
				for (var k=0; k<4; k++){
					var tmp = data["first_half"][row+":"+k];
					fh[0] = fh[0] + tmp[0];
					fh[1] = fh[1] + tmp[1];
					fh[2] = fh[2] + tmp[2];
					var tmp = data["second_half"][row+":"+k];
					sh[0] = sh[0] + tmp[0];
					sh[1] = sh[1] + tmp[1];
					sh[2] = sh[2] + tmp[2];
				}
			}else {
				var fh = data["first_half"][row+":"+col];
				var sh = data["second_half"][row+":"+col];
				var total = [fh[0]+sh[0], fh[1]+sh[1], fh[2]+sh[2]];
				
			}
			var total = [fh[0]+sh[0], fh[1]+sh[1], fh[2]+sh[2]];
			var fhc = "first_half";
			var shc = "second_half";
			var tc = "total";
			if (fh[0]>fh[2]){
				fhc += " positive";
			}else if (fh[0]<fh[2]){
				fhc += " negative";
			}else{
				fhc += " zero";
			}
			if (sh[0]>sh[2]){
				shc += " positive";
			}else if (sh[0]<sh[2]){
				shc += " negative";
			}else{
				shc += " zero";
			}
			if (total[0]>total[2]){
				tc += " positive";
			}else if (total[0]<total[2]){
				tc += " negative";
			}else{
				tc += " zero";
			}
			td.innerHTML = 	 "<span class='" + fhc + "'>" + fh[0]+":"+fh[2]+" ("+fh[1]+")</span>"
								+"<span class='" + shc + "'>" + sh[0]+":"+sh[2]+" ("+sh[1]+")</span>"
								+"<span class='" + tc + "'>" + total[0]+":"+total[2]+" ("+total[1]+")";total[0]+":"+total[2]+" ("+total[1]+")</span>";
			
			tr.appendChild(td);
		}
		body.appendChild(tr);
	}
	table.appendChild(body);
	div.appendChild(table);
	container.appendChild(div);
}


function download(filename, content){
	var element = document.createElement('a');
	element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(content));
	element.setAttribute('download', filename);
	
	element.style.display = 'none';
	document.body.appendChild(element);
	
	element.click();
	
	document.body.removeChild(element);
}

function save(ls=false){
	var data = {};
	data["table"] = table_body_to_array(table_body);
	data["team"] = team_select.checked;
	for (var id of ["general_tournament", "general_place", "general_referee", "general_tableau"]){
		var e = document.getElementById(id);
		data[id] = e.value;
	}
	data["select_left"] = document.getElementById("general_left_name").innerHTML;
	data["select_right"] = document.getElementById("general_right_name").innerHTML;
	
	var json_string = JSON.stringify(data);
	if (ls){
		localStorage.setItem("defaults", json_string);
		shoot_alert("Defaults were saved successfully!", +1);
	}else{
		download("Test", json_string);
	}
}

function load(ls=false){
	try {
		if (ls){
			data_to_fields(localStorage.getItem("defaults"));
			shoot_alert("Defaults were imported successfully!", +1);
		}else{
			var input = document.createElement("input");
			input.type = "file";
			input.addEventListener("change", function(event){
				var file = input.files[0];
				var reader = new FileReader();
				
				reader.addEventListener('load', function (e) {
					var result = reader.result;
					data_to_fields(result);
					shoot_alert("File was imported successfully!", +1);					
				});
				reader.readAsBinaryString(file);
			});
			input.click();
		}
	} catch(err) {
		shoot_alert("Could not load the data!", -1);
		shoot_alert("The error was: " + err, -1);
	}
}

function data_to_fields(json){
	try {
		var data = JSON.parse(json);
		team_select.checked = data["team"];
		for (var id of ["general_tournament", "general_place", "general_referee", "general_tableau"]){
			var e = document.getElementById(id);
			e.value = data[id];
		}
		var select_left = document.getElementById("general_left_name");
		select_left.innerHTML = data["select_left"];
		var select_right = document.getElementById("general_right_name");
		select_right.innerHTML = data["select_right"];
		
		for (var i=0; i<select_right.length; i++){
			add_name("right", select_right.options[i].value);
		}
		for (var i=0; i<select_left.length; i++){
			add_name("left", select_left.options[i].value);
		}
		
		delete_row(all=true);
		create_table_rows(table_body, data["table"]);
		current_score();
	} catch(err) {
		shoot_alert("The error was: " + err, -1);
	}
}

function shoot_alert(content, response_code){
	if (content == "" || content == null){return;}
	var alert_container=document.getElementById("alert_container");
	var newDiv
	newDiv=document.createElement('div');
	newDiv.classList.add("alert_div");
	if (response_code==0){
		color = "#3c3c3c";
		bg_color = "#f9f663";
		icon = "fas fa-exclamation-triangle";
	}else if (response_code==-1){
		color = "white";
		bg_color = "#E84855";
		icon ="fas fa-bug";
	}else{
		color = "white";
		bg_color = "#4B92D8";
		icon = "fas fa-info-circle";
	}
	newDiv.style.color=color;
	newDiv.style.backgroundColor=bg_color;
	newDiv.onclick = function() {this.style.display="none";};
	var newSpan;
	newSpan=document.createElement('span');
	newSpan.innerHTML="&times;"
	newSpan.classList.add("clickable")
	newSpan.classList.add("times_close")
	newSpan.onclick= function() {
		this.parentElement.style.display="none";
	};
	textSpan=document.createElement('span');
	textSpan.innerHTML=content;
	newDiv.appendChild(newSpan);
	newDiv.appendChild(textSpan);
	alert_container.insertBefore(newDiv, alert_container.firstChild);
	log_div = document.getElementById("log_div");
	var today = new Date()
	log_div.innerHTML = "<div>"+("0" + today.getHours()).slice(-2) + ":" +("0" + today.getMinutes()).slice(-2) +" <i class='"+icon+"'></i></div><div>"+content+"</div>" + log_div.innerHTML;
	setTimeout(function(){ newDiv.style.display="none"; }, 3000);
}

function toggle_theme(){
	document.documentElement.classList.toggle('light_theme');
	if (document.documentElement.classList.contains("light_theme")){
		localStorage.setItem("light_theme", 1);
	}else{
		localStorage.setItem("light_theme", 0);
	}
}


function show_all_alerts(){
	var alert_container=document.getElementById("alert_container");
	var alerts=alert_container.children;
	var changes = 0;
	for (var i=0;i<alerts.length;i++){
		if (alerts[i].style.display != "block"){
			changes ++;
		}
		alerts[i].style.display="block";
	}
	if (changes == 0){
		for (var i=0;i<alerts.length;i++){
			alerts[i].style.display="none";
		}
	}
}

function show_modal(content={}){
	if (!("header" in content) && !("body" in content) && !("footer" in content)){
		return;
	}
	var source = ''
	if ("header" in content){
		source += '<h4 class="modal-header">'+content["header"]+'</h4>'
	}
	if ("body" in content){
		source += '<div class="modal-content">'
		source += content["body"]
		source += '</div>'
	}
	if ("footer" in content){
		source += '<div class="modal-footer">'
		source += content["footer"]
		source += '<button class="button btn-default modalCloseButton">Close</button>'
		source += '</div>'
	}
	
	var modalContainer = document.createElement("div");
	modalContainer.classList.add("modal-container");
	
	var modalDiv = document.createElement("div");
	modalDiv.classList.add("modal");
	modalDiv.innerHTML = source;
	modalContainer.appendChild(modalDiv);
	document.body.appendChild(modalContainer);
	
	setTimeout(function(){
		window.addEventListener("click", close_modals);
		for (var elem of document.getElementsByClassName("modalCloseButton")){
			elem.addEventListener("click", function(){close_modals(true);});
		}
	},0);
}

function close_modals(event=true){
	if (event != true){
		if (!event.target.classList.contains("modal-container")){
			return;
		}
	}
	
	for (var elem of document.getElementsByClassName("modal-container")){
		elem.remove();
	}
	window.removeEventListener("click", close_modals);
}

function add_to_textarea(side, text){
	var textarea = document.getElementById("touch_"+side+"_notes");
	var current_text = textarea.value;
	if (current_text != ""){
		text = "; " + text;
	}
	textarea.value += text;
}


var texts = ["Parade", "Riposte", "Prim", "Sekund", "Terz", "Quart", "Qunit", "KreisTerz", "ContraRiposte", "ReContraRiposte", false, "Vorhieb", "Bingo", "Eisenhieb", "ContraAttack", "Aussperren", "ContraAttack Aussperren", "Übernahme", "Remise", "Linie", false, "Flanke", "Kopf", "Bauch", "Hand", "Stoß", false, "Großen Schritt", "2 kleine Schritte", "SchrittStop", "Sprung", "Sprung Schritt", "Schritt Sprung", "Appell", "Hinteren Bein Startet"];
function show_abbrev_modal(side){
	content = {};
	content["header"] = "Add Text";
	content["body"]   = "<p>Click the buttons to add to the textarea: </p><div><hr>";
	
	for (var text of texts){
		if (text == false){
			content["body"] += "<hr>";
		} else {
			content["body"] += "<button class='button' onclick='add_to_textarea(\""+side+"\", \""+text+"\")'>"+text+"</button>";
		}
	}
	
	content["body"] += "<hr></div>";
	
	content["footer"] = "";
	
	show_modal(content);
}

if (localStorage.getItem('light_theme') !== null){
	if (localStorage.getItem('light_theme') == 1){
		toggle_theme();
	}
};

quotes_str = '["Deine Leute alles Platzpatronen,\\nMeine Leute halten stand wie ein Bataillon\\n-Anis M. Y. Ferchichi", "Was sie rappen ist kein Image, das ist Science Fiction\\n-Anis M. Y. Ferchichi", "Erstens kommt es anders und zweitens als man denkt\\n-Ekrem Bora", "In der Theorie willst du was ver\\u00e4ndern, aber in der Praxis geht alles schief.\\nIn der Theorie wollen wir zu viel, geben aber viel zu wenig, das ist kein fairer Deal.\\n-Anis M. Y. Ferchichi & Jochen Burchard", "Und bist du unten, dr\\u00fccken sie dich noch ein St\\u00fcck tiefer\\nNoch ein St\\u00fcck tiefer\\nNoch ein St\\u00fcck tiefer\\nNoch ein St\\u00fcck tiefer\\n-Anis M. Y. Ferchichi", "Da ting goes skrrrrahh, pap, pap, ka-ka-ka\\nSkidiki-pap-pap, and a pu-pu-pudrrrr-boom\\nSkya, du-du-ku-ku-dun-dun\\nPoom, poom, you dun know\\n-Michael Dapaah", "Einstein, my mind, this MC move white squares with my relatives.\\n-Shawn C. Carter", "Man kann es weder sehen noch ber\\u00fchren, lediglich sp\\u00fcren.\\n-Anis M. Y. Ferchichi", "Dank mir ist das Niveau im Keller, so wie Weinf\\u00e4sser\\n-Anis M. Y. Ferchichi", "Meine Punchlines sind w\\u00e4hlerisch, aber dich zers\\u00e4ge ich\\n-Vladislav Balovatsky", "Bratan l\\u00e4uft, Para und Erfolg\\nGestern war\'n die Platten grau, heute sind sie Gold\\n-Vladislav Balovatsky", "Das Leben ist \'ne Schachtel Pralinen\\nUnd alle kriegen das, was sie verdienen\\nEgal, wie schnell du rennst, vor Gott kannst du nicht fliehen\\nInshallah deine S\\u00fcnden werden verziehen\\n-Vladislav Balovatsky", "F\\u00fcr meine Tochter, der ich sp\\u00e4ter mal erz\\u00e4hlen kann\\nIhr Vater war ein Ehrenmann\\n-Anis M. Y. Ferchichi", "Nachts, da schlafe ich\\n-Deutscher Philosoph", "It wasn\'t me\\n-Orville Richard Burrell", "Und du bist, alles f\\u00fcr mich, alles das, was mir Angst macht\\nMeine silberne Kugel, mein Kryptonit und mein Anthrax\\n-Friedrich Kautz", "Jack-Daniel\'s-Eis, Hennessy und Johnnie Walker\\nIch komm\' voll besoffen in \'nem Gucci-Jogger\\n-Vladislav Balovatsky", "There is no such thing as too much duct tape\\n-Oli", "We are going so fast\\nBut time so slow\\n-Theory of Relativity", "D\\u00f6p, d\\u00f6p, d\\u00f6p, d\\u00f6p, d\\u00f6d\\u00f6d\\u00f6d\\u00f6d\\u00f6p\\nD\\u00f6, d\\u00f6d\\u00f6d\\u00f6p, d\\u00f6p, d\\u00f6d\\u00f6d\\u00f6d\\u00f6d\\u00f6p, d\\u00f6p\\n-Hans Peter Geerdes", "Skibadee, skibadanger\\nI am the rearranger\\n-Hans Peter Geerdes", "If we could only slow the time\\nWe would have forever every night\\n-Don Pepijn Schipper", "Meine Stra\\u00dfenpoesie l\\u00f6st die Chaostheorie\\n-Mousa Amouei", "Die Parabel sie steigt, und zwar exponentiell\\n-Mohamed El Moussaoui", "Chuba chuba chuba chuba chuba chuba chubby.\\nI don\'t have any lines to go right here, so chuby Teletubby\\n-Marshall Bruce Mathers III", "Two things are infinite: The universe and human stupidity;\\nand I\\u2018m not sure about the universe\\n-Albert E", "Physics is like sex: sure, it may give some practical results, but that\'s not why we do it.\\n-Richard P. Feynman", "I do not think you can name many great inventions that have been made by married men.\\n-Nikola Tesla", "Those who are not shocked when they first come across quantum theory cannot possibly have understood it.\\n-Niels Bohr", "We\\u2019re not free in what we do, because we\\u2019re not free in what we want.\\n-Jonas Kahnwald", "What we know is a drop. What we don\\u2019t know is an ocean.\\n-Isaac Newton", "Oh fate, you mysterious bitch\\nWhy you doing this to me\\n-Theodore \\"T-Bag\\" Bagwell", "We are captives of our own identities, living in prisons of our own creation.\\n-Theodore \\"T-Bag\\" Bagwell", "Preparation can only take you so far. \\nAfter that, you have to take a few leaps of faith.\\n-Michael Scofield", "Das ist der Sound f\\u00fcr die echten M\\u00e4nner, die das hier h\\u00f6ren, wenn sie Pressluft h\\u00e4mmern\\n-Tarek Ebene, Nico Seyfrid & Maxim Dr\\u00fcner"]';
function change_quote(){
	quotes = JSON.parse(quotes_str);
	quote = quotes[Math.floor(Math.random() * (quotes.length))];
	quote = quote.replace(/(?:\r\n|\r|\n)/g, '<br>');;
	document.getElementById("quote1").children[0].innerHTML = quote;
	document.getElementById("quote2").children[0].innerHTML = quote;
}
change_quote();

// Register service worker to control making site work offline
if('serviceWorker' in navigator) {
	navigator.serviceWorker.register('sw.js', {scope: "/Fechtanalyse/"})
		.then(function(registration) {
			console.log('Service Worker Registered');
	});
}
</script>
</body>
</html>
